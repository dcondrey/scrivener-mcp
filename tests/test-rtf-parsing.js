import { RTFHandler } from '../dist/services/parsers/rtf-handler.js';

async function test() {
  const handler = new RTFHandler();
  
  // Test 1: Simple RTF
  console.log('Test 1: Simple RTF');
  const simple = `{\\rtf1\\ansi\\deff0 {\\fonttbl{\\f0 Times;}}
\\f0 Simple text\\par
}`;
  
  const result1 = await handler.parseRTF(simple);
  console.log('  Plain text:', JSON.stringify(result1.plainText));
  console.log('  Segments:', result1.formattedText.length);
  
  // Test 2: RTF generated by our system
  console.log('\nTest 2: Generated RTF');
  const generated = `{\\rtf1\\ansi\\deff0\\uc0{\\fonttbl{\\f0\\fnil\\fcharset0 Times;}}\\f0\\fs24 New content after write}`;
  
  const result2 = await handler.parseRTF(generated);
  console.log('  Plain text:', JSON.stringify(result2.plainText));
  console.log('  Segments:', result2.formattedText.length);
  
  // Test 3: Write and read back
  console.log('\nTest 3: Write and read back');
  await handler.writeRTF('/tmp/test3.rtf', 'Hello World');
  const result3 = await handler.readRTF('/tmp/test3.rtf');
  console.log('  Plain text:', JSON.stringify(result3.plainText));
  console.log('  Segments:', result3.formattedText.length);
  
  // Test 4: Check what writeRTF generates
  console.log('\nTest 4: Check generated RTF');
  await handler.writeRTF('/tmp/test4.rtf', 'Test content');
  const fs = await import('fs/promises');
  const rtf = await fs.readFile('/tmp/test4.rtf', 'utf-8');
  console.log('  Generated RTF:', rtf.substring(0, 100) + '...');
  
  // Parse it back
  const result4 = await handler.parseRTF(rtf);
  console.log('  Plain text:', JSON.stringify(result4.plainText));
  console.log('  Segments:', result4.formattedText.length);
}

test().catch(console.error);